<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Depuración Imagen Aleatoria</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9ff; }
    img { max-width: 80vw; max-height: 60vh; border: 2px solid #333; margin: 20px 0; }
    pre { background: #eee; padding: 8px; border-radius: 8px; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>Depuración Imagen Aleatoria Google Drive</h2>
  <div id="json"></div>
  <div id="link"></div>
  <img id="imagen" src="" alt="Imagen aleatoria" style="display:none">
  <div id="error" class="error"></div>
  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycby0XgNjFhjgtSQA4ttI5ZK-gJLCIbRFZI6eMuM2d_DqEuD4hS4nefjhDpsjK8I791lXRA/exec";

    fetch(API_URL)
      .then(r => r.json())
      .then(data => {
        // Muestra el JSON recibido en pantalla
        document.getElementById("json").innerHTML = "<b>JSON recibido:</b><pre>" + JSON.stringify(data, null, 2) + "</pre>";

        if (!data || !data.length) {
          document.getElementById("error").innerText = "No hay imágenes disponibles.";
          return;
        }
        // Escoge una imagen aleatoria
        const imgObj = data[Math.floor(Math.random() * data.length)];
        document.getElementById("link").innerHTML = `<b>Enlace de imagen:</b> <a href="${imgObj.url}" target="_blank">${imgObj.url}</a>`;

        const imgTag = document.getElementById("imagen");
        imgTag.src = imgObj.url;
        imgTag.style.display = "block";

        imgTag.onload = function() {
          document.getElementById("error").innerText = "";
        };
        imgTag.onerror = function(e) {
          document.getElementById("error").innerText = "La imagen no está disponible o no es pública.\nPrueba el enlace directo arriba.";
          console.log("Error al cargar imagen:", imgObj.url, e);
        };
      })
      .catch(error => {
        document.getElementById("error").innerText = "Error al cargar el JSON del Apps Script: " + error;
        console.log("Fallo en fetch:", error);
      });
  </script>
</body>
</html>
